<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist Di√°rio de Ve√≠culos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<!-- html2pdf -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
/* =============================
   ESTILO GERAL DO CHECKLIST
   ============================= */
body { font-family: Arial, sans-serif; background: #f4f4f4; padding: 10px; }
.container { max-width: 900px; margin: auto; background: #fff; padding: 20px; border-radius: 6px; }
.logo { text-align: center; margin-bottom: 10px; }
.logo img { max-width: 150px; display: block; margin: 0 auto; }
h2, .datetime { text-align: center; margin: 5px 0; }
label { font-weight: bold; display: block; margin-top: 8px; }
input, select, textarea { width: 100%; padding: 8px; box-sizing: border-box; border: 1px solid #ccc; border-radius: 4px; }
button { margin-top: 15px; padding: 12px 24px; font-size: 16px; cursor: pointer; border: none; border-radius: 6px; background: #0a7cff; color: white; }
button:hover:not(:disabled) { background: #0962d8; }
button:disabled { background: #ccc; cursor: not-allowed; }

/* TELAS */
.tela { display: none; }
.tela.ativa { display: block; }

/* GRID DE SELE√á√ÉO */
.grid { display: flex; flex-wrap: wrap; gap: 15px; margin-top: 20px; }
.grid > div { flex: 1 1 280px; min-width: 250px; }

/* RESUMO */
.resumo { background: #f8f9fa; padding: 15px; border-radius: 6px; margin: 15px 0; }
.resumo p { margin: 5px 0; font-size: 16px; }

/* TABELA */
.table { width: 100%; border-collapse: collapse; margin: 20px 0; }
.table th, .table td { border: 1px solid #333; padding: 8px; font-size: 14px; text-align: center; cursor: pointer; height: 25px; }
.table th { background: #e9ecef; font-weight: bold; }
.table th:first-child, .table td:first-child { text-align: left; width: 40%; }

/* cores dos estados */
.bom { background: #fff; }
.anormal { background: #fff; }
.na { background: #fff; }

/* destaque ANORMAL no PDF */
.anormal-pdf { background: #ff4d4f !important; color: white !important; }

/* OBSERVA√á√ïES */
.obs-box { margin: 20px 0; }

/* KM/HORIMETRO */
#kmHorimetro { width: 200px !important; display: inline-block; }

/* RODAP√â */
.rodape { text-align: center; margin-top: 20px; font-size: 14px; }

/* PDF ENQUADRADO RETRATO */
#pdf-content { width: 190mm; margin: 0 auto; padding: 10mm; display:none; }
#pdf-content .container { width: 100%; margin: 0; padding: 0; }
#pdf-content h2, #pdf-content p { text-align: center; }
#pdf-content .table { width: 100%; border-collapse: collapse; }
#pdf-content .rodape { text-align: center; font-size: 14px; margin-top: 20px; }

/* MEDIA PRINT PARA PDF */
@media print { body { background: white; } .container { max-width: none; padding: 10mm; } .tela:not(.ativa), button { display: none !important; } }
</style>
</head>

<body>

<!-- PDF escondido -->
<div id="pdf-content">
  <div class="container">
    <div class="logo"><img src="Logo.png" alt="Logo da Empresa"></div>
    <h2>Checklist Di√°rio de Inspe√ß√£o</h2>
    <p>CNPJ: 00.000.000/0000-00</p>
  </div>

  <div class="container">
    <div class="resumo">
      <p><strong>Motorista:</strong> <span id="resumoMotorista"></span></p>
      <p><strong>Ve√≠culo:</strong> <span id="resumoVeiculo"></span></p>
      <p><strong>Tipo:</strong> <span id="resumoTipo"></span></p>
      <p><strong>KM ou Hor√≠metro:</strong> <span id="kmPDF"></span></p>
      <p><strong>Data e Hora:</strong> <span id="datetime-pdf"></span></p>
    </div>

    <table class="table" id="tabelaPDF">
      <thead>
        <tr>
          <th>ITEM</th>
          <th>BOM</th>
          <th>ANORMAL</th>
          <th>N.A.</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="obs-box">
      <label>Observa√ß√µes</label>
      <div id="obs-pdf"></div>
    </div>
  </div>

  <div class="rodape">
    Endere√ßo: Av. Exemplo, 123 - Cidade - CEP 00000-000
  </div>
</div>

<!-- TELA 1: SELE√á√ÉO -->
<div class="container tela ativa" id="tela-selecao">
  <h3>üìã Dados iniciais</h3>
  <div class="grid">
    <div>
      <label>Motorista / Operador</label>
      <input type="text" id="motorista" placeholder="Digite o nome do motorista">
    </div>
    <div>
      <label>Ve√≠culo / Placa ou Patrim√¥nio</label>
      <input type="text" id="veiculo" placeholder="Digite a placa ou patrim√¥nio">
    </div>
    <div>
      <label>Tipo de Ve√≠culo</label>
      <select id="tipo">
        <option value="">Selecione</option>
        <option value="empilhadeira">Empilhadeira</option>
        <option value="carro">Carro</option>
        <option value="bau">Caminh√£o Ba√∫</option>
        <option value="f400">Caminh√£o Aberto (F400)</option>
      </select>
    </div>
  </div>
  <button onclick="irParaChecklist()">‚û°Ô∏è Continuar para checklist</button>
</div>

<!-- TELA 2: CHECKLIST -->
<div class="container tela" id="tela-checklist">
  <div class="resumo">
    <p><strong>Motorista:</strong> <span id="resumoMotoristaCheck"></span></p>
    <p><strong>Ve√≠culo:</strong> <span id="resumoVeiculoCheck"></span></p>
    <p><strong>Tipo:</strong> <span id="resumoTipoCheck"></span></p>
    <p><strong>KM ou Hor√≠metro:</strong> <input type="number" id="kmHorimetro" min="0"></p>
    <p><strong>Data e Hora:</strong> <span id="datetimeCheck"></span></p>
  </div>

  <table class="table" id="tabelaCheck">
    <thead>
      <tr>
        <th>ITEM</th>
        <th>BOM</th>
        <th>ANORMAL</th>
        <th>N.A.</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="obs-box">
    <label>Observa√ß√µes (obrigat√≥rio se houver item ANORMAL)</label>
    <textarea id="obs" rows="3" placeholder="Descreva qualquer irregularidade..."></textarea>
  </div>

  <button onclick="voltarSelecao()">‚¨ÖÔ∏è Voltar</button>
  <button id="salvar" onclick="salvarChecklist()" disabled>üíæ Salvar Checklist</button>
  <button onclick="gerarPDF()">üìÑ Gerar PDF</button>

  <div class="rodape">
    Endere√ßo da empresa: Av. Beira Rio Sul, 1169 - Jardim California - Cuiab√° - CEP 78070-500
  </div>
</div>

<script>
// MODELOS DE CHECKLIST
const modelos = {
  empilhadeira: ["Pneus e Rodas (calibragem)","Garfos (patins) e mastro","Vazamentos","N√≠vel de √≥leo do motor","N√≠vel de √≥leo hidr√°ulico","Freios","Buzina / sinaliza√ß√£o"],
  carro: ["Luzes","Vazamentos","Espelhos e vidros"],
  bau: ["Pneus","Luzes","Vazamentos","Freios"],
  f400: ["Pneus","Luzes","Vazamentos","Freios"]
};

// DATA/HORA
document.getElementById('datetimeCheck').innerText = new Date().toLocaleString();

// TROCAR DE TELA
function irParaChecklist(){
  const motorista = document.getElementById('motorista').value;
  const veiculo = document.getElementById('veiculo').value;
  const tipo = document.getElementById('tipo').value;

  if(!motorista || !veiculo || !tipo){
    alert("Preencha todos os campos!");
    return;
  }

  // Atualiza resumo da tela checklist
  document.getElementById('resumoMotoristaCheck').innerText = motorista;
  document.getElementById('resumoVeiculoCheck').innerText = veiculo;
  document.getElementById('resumoTipoCheck').innerText = tipo;

  // Preenche tabela da tela checklist
  const tbody = document.querySelector('#tabelaCheck tbody');
  tbody.innerHTML = "";
  modelos[tipo].forEach(item=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item}</td>
      <td class="bom" onclick="selecionar(this)"></td>
      <td class="anormal" onclick="selecionar(this)"></td>
      <td class="na" onclick="selecionar(this)"></td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById('tela-selecao').classList.remove('ativa');
  document.getElementById('tela-checklist').classList.add('ativa');
  verificarSalvar();
}

// SELE√á√ÉO CELULAS
function selecionar(td){
  td.parentNode.querySelectorAll('td').forEach(cell=>{
    if(cell !== td.parentNode.children[0]) cell.style.backgroundColor = "";
  });
  td.style.backgroundColor = td.classList.contains('bom') ? "#c8f7c5"
    : td.classList.contains('anormal') ? "#fff3b0"
    : "#c5d9f7";
  verificarSalvar();
}

// VERIFICA SALVAR
function verificarSalvar(){
  const tbody = document.querySelectorAll('#tabelaCheck tbody tr');
  let habilitar = tbody.length > 0;
  tbody.forEach(tr=>{
    if(!Array.from(tr.children).slice(1).some(td=>td.style.backgroundColor)) habilitar=false;
  });
  document.getElementById('salvar').disabled = !habilitar;
}

// VOLTAR
function voltarSelecao(){
  document.getElementById('tela-checklist').classList.remove('ativa');
  document.getElementById('tela-selecao').classList.add('ativa');
}

// SALVAR
function salvarChecklist(){
  alert("Checklist salvo com sucesso!");
}

// GERAR PDF
function gerarPDF(){
  const pdfDiv = document.getElementById('pdf-content');

  // Atualiza dados PDF
  document.getElementById('resumoMotorista').innerText = document.getElementById('motorista').value;
  document.getElementById('resumoVeiculo').innerText = document.getElementById('veiculo').value;
  document.getElementById('resumoTipo').innerText = document.getElementById('tipo').value;
  document.getElementById('kmPDF').innerText = document.getElementById('kmHorimetro').value;
  document.getElementById('datetime-pdf').innerText = new Date().toLocaleString();
  document.getElementById('obs-pdf').innerText = document.getElementById('obs').value;

  // Copiar tabela
  const tbodyPDF = document.querySelector('#tabelaPDF tbody');
  const tbodyCheck = document.querySelector('#tabelaCheck tbody');
  tbodyPDF.innerHTML = tbodyCheck.innerHTML;

  // Destacar ANORMAIS
  tbodyPDF.querySelectorAll('tr').forEach(tr=>{
    const tdAnormal = tr.querySelector('.anormal');
    if(tdAnormal.style.backgroundColor === "rgb(255, 243, 176)"){ tr.classList.add('anormal-pdf'); }
  });

  html2pdf().set({
    margin:10,
    filename:`Checklist_${new Date().toISOString().slice(0,10)}.pdf`,
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  }).from(pdfDiv).save();
}

// SERVICE WORKER
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
  .then(()=>console.log('Service Worker registrado'))
  .catch(err=>console.log('Erro SW',err));
}
</script>
</body>
</html>
