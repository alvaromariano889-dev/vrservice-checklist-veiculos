<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist Diário</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 10px;
}

.container {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 6px;
}

.logo, h2, .datetime {
  text-align: center;
}

label {
  font-weight: bold;
}

input, select, textarea {
  width: 100%;
  padding: 6px;
  box-sizing: border-box;
}

button {
  margin-top: 15px;
  padding: 10px 30px;
  font-size: 16px;
  cursor: pointer;
}

button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* telas */
.tela {
  display: none;
}

.tela.ativa {
  display: block;
}

/* layout seleção */
.grid {
  display: flex;
  flex-wrap: wrap;
  gap: 10px;
}

.grid > div {
  flex: 1 1 200px;
}

/* tabela checklist */
.table {
  width: 100%;
  border-collapse: collapse;
  margin-top: 15px;
}

.table th, .table td {
  border: 1px solid #000;
  padding: 8px;
  text-align: center;
}

.table th:first-child,
.table td:first-child {
  text-align: left;
}

.bom { background: #c8f7c5; }
.anormal { background: #f7c5c5; }
.na { background: #c5d9f7; }

.obs-box {
  margin-top: 15px;
}
</style>
</head>

<body>

<div class="container">
  <div class="logo"><strong>LOGO DA EMPRESA</strong></div>
  <h2>Checklist Diário de Inspeção</h2>
  <div class="datetime" id="datetime"></div>
</div>

<!-- TELA 1: SELEÇÃO -->
<div class="container tela ativa" id="tela-selecao">
  <h3>Dados iniciais</h3>

  <div class="grid">
    <div>
      <label>Motorista / Operador</label>
      <input type="text" id="motorista">
      <button type="button" onclick="salvarMotorista()">Salvar motorista</button>
      <select id="listaMotoristas" onchange="selecionarMotorista()">
        <option value="">Motoristas salvos</option>
      </select>
    </div>

    <div>
      <label>Veículo / Placa ou Patrimônio</label>
      <input type="text" id="veiculo">
      <button type="button" onclick="salvarVeiculo()">Salvar veículo</button>
      <select id="listaVeiculos" onchange="selecionarVeiculo()">
        <option value="">Veículos salvos</option>
      </select>
    </div>

    <div>
      <label>Tipo de Veículo</label>
      <select id="tipo">
        <option value="">Selecione</option>
        <option value="empilhadeira">Empilhadeira</option>
        <option value="carro">Carro</option>
        <option value="bau">Caminhão Baú</option>
        <option value="f400">Caminhão Aberto (F400)</option>
      </select>
    </div>
  </div>

  <button type="button" onclick="irParaChecklist()">Continuar para checklist</button>
</div>

<!-- TELA 2: CHECKLIST -->
<div class="container tela" id="tela-checklist">
  <h3>Checklist do veículo</h3>
  <p><strong>Motorista:</strong> <span id="resumoMotorista"></span></p>
  <p><strong>Veículo:</strong> <span id="resumoVeiculo"></span></p>
  <p><strong>Tipo:</strong> <span id="resumoTipo"></span></p>

  <table class="table" id="tabela">
    <thead>
      <tr>
        <th>ITEM</th>
        <th>BOM</th>
        <th>ANORMAL</th>
        <th>N.A.</th>
        <th>Valor</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="obs-box">
    <label>Observações (obrigatório se houver item ANORMAL)</label>
    <textarea id="obs" rows="3"></textarea>
  </div>

  <button type="button" onclick="voltarSelecao()">Voltar</button>
  <button id="salvar" type="button" onclick="salvarChecklist()" disabled>Salvar Checklist</button>
</div>

<script>
// modelos de checklist: itens comuns + marca se precisa de campo numérico
const modelos = {
  empilhadeira: [
    { texto: "Pneus e Rodas (calibragem)", numero: false },
    { texto: "Garfos (patins) e mastro", numero: false },
    { texto: "Vazamentos", numero: false },
    { texto: "Nível de óleo do motor", numero: false },
    { texto: "Nível de óleo hidráulico", numero: false },
    { texto: "Freios", numero: false },
    { texto: "Buzina / sinalização", numero: false },
    { texto: "Horímetro", numero: true }      // numérico
  ],
  carro: [
    { texto: "Luzes", numero: false },
    { texto: "Vazamentos", numero: false },
    { texto: "Espelhos e vidros", numero: false },
    { texto: "Freios", numero: false },
    { texto: "Nível de fluidos", numero: false },
    { texto: "Rodas / pneus", numero: false },
    { texto: "KM", numero: true }             // numérico
  ],
  bau: [
    { texto: "Luzes", numero: false },
    { texto: "Vazamentos", numero: false },
    { texto: "Freios", numero: false },
    { texto: "Nível de fluidos", numero: false },
    { texto: "Rodas / pneus", numero: false },
    { texto: "Baú (portas e travas)", numero: false },
    { texto: "KM", numero: true }             // numérico
  ],
  f400: [
    { texto: "Luzes", numero: false },
    { texto: "Vazamentos", numero: false },
    { texto: "Freios", numero: false },
    { texto: "Nível de fluidos", numero: false },
    { texto: "Rodas / pneus", numero: false },
    { texto: "Carroceria / carga", numero: false },
    { texto: "KM", numero: true }             // numérico
  ]
};

// relógio
function atualizarDataHora() {
  const d = new Date();
  document.getElementById("datetime").innerText =
    d.toLocaleDateString("pt-BR") + " " + d.toLocaleTimeString("pt-BR");
}
setInterval(atualizarDataHora, 1000);
atualizarDataHora();

// motoristas/veículos salvos
const CHAVE_MOTORISTAS = "motoristas_salvos";
const CHAVE_VEICULOS = "veiculos_salvos";

function carregarListas() {
  const listaM = JSON.parse(localStorage.getItem(CHAVE_MOTORISTAS) || "[]");
  const listaV = JSON.parse(localStorage.getItem(CHAVE_VEICULOS) || "[]");

  const selM = document.getElementById("listaMotoristas");
  const selV = document.getElementById("listaVeiculos");

  selM.innerHTML = "<option value=''>Motoristas salvos</option>";
  listaM.forEach(n => selM.innerHTML += `<option value="${n}">${n}</option>`);

  selV.innerHTML = "<option value=''>Veículos salvos</option>";
  listaV.forEach(v => selV.innerHTML += `<option value="${v}">${v}</option>`);
}

function salvarMotorista() {
  const nome = document.getElementById("motorista").value.trim();
  if (!nome) return;
  let lista = JSON.parse(localStorage.getItem(CHAVE_MOTORISTAS) || "[]");
  if (!lista.includes(nome)) {
    lista.push(nome);
    localStorage.setItem(CHAVE_MOTORISTAS, JSON.stringify(lista));
    carregarListas();
  }
}

function salvarVeiculo() {
  const v = document.getElementById("veiculo").value.trim();
  if (!v) return;
  let lista = JSON.parse(localStorage.getItem(CHAVE_VEICULOS) || "[]");
  if (!lista.includes(v)) {
    lista.push(v);
    localStorage.setItem(CHAVE_VEICULOS, JSON.stringify(lista));
    carregarListas();
  }
}

function selecionarMotorista() {
  const valor = document.getElementById("listaMotoristas").value;
  if (valor) document.getElementById("motorista").value = valor;
}

function selecionarVeiculo() {
  const valor = document.getElementById("listaVeiculos").value;
  if (valor) document.getElementById("veiculo").value = valor;
}

carregarListas();

// navegação telas
function irParaChecklist() {
  const m = document.getElementById("motorista").value.trim();
  const v = document.getElementById("veiculo").value.trim();
  const t = document.getElementById("tipo").value;

  if (!m || !v || !t) {
    alert("Preencha Motorista, Veículo e Tipo de veículo.");
    return;
  }

  // resumo
  document.getElementById("resumoMotorista").innerText = m;
  document.getElementById("resumoVeiculo").innerText = v;
  document.getElementById("resumoTipo").innerText =
    document.getElementById("tipo").options[document.getElementById("tipo").selectedIndex].text;

  montarChecklist(t);

  document.getElementById("tela-selecao").classList.remove("ativa");
  document.getElementById("tela-checklist").classList.add("ativa");
}

function voltarSelecao() {
  document.getElementById("tela-checklist").classList.remove("ativa");
  document.getElementById("tela-selecao").classList.add("ativa");
}

// monta checklist da tela 2
function montarChecklist(tipo) {
  const tbody = document.querySelector("#tabela tbody");
  tbody.innerHTML = "";
  document.getElementById("obs").value = "";
  document.getElementById("salvar").disabled = true;

  const modelo = modelos[tipo];
  if (!modelo) return;

  modelo.forEach((item, i) => {
    tbody.innerHTML += `
      <tr>
        <td>${item.texto}</td>
        <td><input type="radio" name="i${i}" onclick="marcar(this,'bom')"></td>
        <td><input type="radio" name="i${i}" onclick="marcar(this,'anormal')"></td>
        <td><input type="radio" name="i${i}" onclick="marcar(this,'na')"></td>
        <td>${item.numero ? `<input type="number" min="0" id="num${i}" style="width:100%; padding:4px;">` : ""}</td>
      </tr>
    `;
  });
}

// marca linha e revalida
function marcar(radio, tipo) {
  const linha = radio.closest("tr");
  linha.classList.remove("bom", "anormal", "na");
  linha.classList.add(tipo);
  validar();
}

// valida checklist
function validar() {
  const linhas = document.querySelectorAll("#tabela tbody tr");
  let todosMarcados = true;
  let existeAnormal = false;

  linhas.forEach(l => {
    const marcado = l.querySelector("input[type=radio]:checked");
    if (!marcado) {
      todosMarcados = false;
    } else if (l.classList.contains("anormal")) {
      existeAnormal = true;
    }
  });

  const obs = document.getElementById("obs").value.trim();
  let obsOk = true;
  if (existeAnormal && obs === "") obsOk = false;

  document.getElementById("salvar").disabled = !(todosMarcados && obsOk);
}

document.getElementById("obs").addEventListener("input", validar);

// salva checklist localmente
function salvarChecklist() {
  const motorista = document.getElementById("motorista").value.trim();
  const veiculo = document.getElementById("veiculo").value.trim();
  const tipo = document.getElementById("tipo").value;
  const obs = document.getElementById("obs").value.trim();

  const linhas = document.querySelectorAll("#tabela tbody tr");
  const itens = [];

  linhas.forEach((l, idx) => {
    const texto = l.cells[0].innerText;
    let status = "";
    if (l.classList.contains("bom")) status = "BOM";
    else if (l.classList.contains("anormal")) status = "ANORMAL";
    else if (l.classList.contains("na")) status = "NA";

    const inputNum = l.querySelector("input[type=number]");
    const valorNum = inputNum ? inputNum.value : "";

    itens.push({
      ordem: idx + 1,
      item: texto,
      status,
      valor: valorNum
    });
  });

  const agora = new Date();
  const registro = {
    id: Date.now(),
    dataISO: agora.toISOString(),
    dataBR: agora.toLocaleDateString("pt-BR"),
    horaBR: agora.toLocaleTimeString("pt-BR"),
    motorista,
    veiculo,
    tipo,
    itens,
    obs
  };

  const chave = "checklists_diarios";
  const lista = JSON.parse(localStorage.getItem(chave) || "[]");
  lista.push(registro);
  localStorage.setItem(chave, JSON.stringify(lista));

  alert("Checklist salvo com sucesso (neste dispositivo).");
}
</script>

</body>
</html>
