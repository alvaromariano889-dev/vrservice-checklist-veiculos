<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist Di√°rio de Ve√≠culos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<!-- PDF A4 -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 10px;
}

.container {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 6px;
}

.logo { text-align:center; margin-bottom:10px; }
.logo img { max-width:150px; }

h2, .datetime {
  text-align: center;
  margin: 5px 0;
}

label {
  font-weight: bold;
  display: block;
  margin-top: 8px;
}

input, select, textarea {
  width: 100%;
  padding: 8px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 4px;
}

button {
  margin-top: 15px;
  padding: 12px 24px;
  font-size: 16px;
  cursor: pointer;
  border: none;
  border-radius: 6px;
  background: #0a7cff;
  color: white;
}

button:hover:not(:disabled) {
  background: #0962d8;
}

button:disabled {
  background: #ccc;
  cursor: not-allowed;
}

/* telas */
.tela {
  display: none;
}
.tela.ativa {
  display: block;
}

/* sele√ß√£o */
.grid {
  display: flex;
  flex-wrap: wrap;
  gap: 15px;
  margin-top: 20px;
}
.grid > div {
  flex: 1 1 280px;
  min-width: 250px;
}

/* resumo */
.resumo {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 6px;
  margin: 15px 0;
}
.resumo p {
  margin: 5px 0;
  font-size: 16px;
}

/* tabela */
.table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
}
.table th, .table td {
  border: 1px solid #333;
  padding: 10px 8px;
  text-align: center;
  font-size: 14px;
}
.table th {
  background: #e9ecef;
  font-weight: bold;
}
.table th:first-child, .table td:first-child {
  text-align: left;
  width: 40%;
}

.bom { background: #c8f7c5 !important; }
.anormal { background: #fff3b0 !important; }
.na { background: #c5d9f7 !important; }

/* PDF destaque ANORMAL */
.anormal-pdf { background: #ff4d4f !important; color: white !important; }

.obs-box {
  margin: 20px 0;
}

#kmHorimetro {
  width: 200px !important;
  display: inline-block;
}

/* rodape */
.rodape { text-align:center; margin-top:20px; font-size:14px; }

/* PDF otimizado */
@media print {
  body { background: white; }
  .container { max-width: none; padding: 10mm; }
  .tela:not(.ativa), button { display: none !important; }
}
</style>
</head>

<body>

<div id="pdf-content">

  <!-- LOGO E TITULO -->
  <div class="container">
    <div class="logo">
      <img src="Logo.png" alt="Logo da Empresa">
    </div>
    <h2>Checklist Di√°rio de Inspe√ß√£o</h2>
    <p style="text-align:center">CNPJ: 00.000.000/0000-00</p>
    <div class="datetime" id="datetime"></div>
  </div>

  <!-- TELA 1: SELE√á√ÉO -->
  <div class="container tela ativa" id="tela-selecao">
    <h3>üìã Dados iniciais</h3>

    <div class="grid">
      <div>
        <label>Motorista / Operador</label>
       <input type="text" id="motorista" placeholder="Digite o nome do motorista">
          <option value="">Digite ou selecione</option>
        </select>
      </div>

      <div>
        <label>Ve√≠culo / Placa ou Patrim√¥nio</label>
         <input type="text" id="veiculo" placeholder="Digite a placa ou patrim√¥nio">
          <option value="">Digite ou selecione</option>
        </select>
      </div>

      <div>
        <label>Tipo de Ve√≠culo</label>
        <select id="tipo">
          <option value="">Selecione</option>
          <option value="empilhadeira">Empilhadeira</option>
          <option value="carro">Carro</option>
          <option value="bau">Caminh√£o Ba√∫</option>
          <option value="f400">Caminh√£o Aberto (F400)</option>
        </select>
      </div>
    </div>

    <button onclick="irParaChecklist()">‚û°Ô∏è Continuar para checklist</button>
  </div>

  <!-- TELA 2: CHECKLIST -->
  <div class="container tela" id="tela-checklist">
    <div class="resumo">
      <p><strong>Motorista:</strong> <span id="resumoMotorista"></span></p>
      <p><strong>Ve√≠culo:</strong> <span id="resumoVeiculo"></span></p>
      <p><strong>Tipo:</strong> <span id="resumoTipo"></span></p>
      <p><strong>KM ou Hor√≠metro:</strong> <input type="number" id="kmHorimetro" min="0"></p>
      <p><strong>Data e Hora:</strong> <span id="datetime-pdf"></span></p>
    </div>

    <table class="table" id="tabela">
      <thead>
        <tr>
          <th>ITEM</th>
          <th>BOM</th>
          <th>ANORMAL</th>
          <th>N.A.</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <div class="obs-box">
      <label>Observa√ß√µes (obrigat√≥rio se houver item ANORMAL)</label>
      <textarea id="obs" rows="3" placeholder="Descreva qualquer irregularidade encontrada..."></textarea>
    </div>

    <button onclick="voltarSelecao()">‚¨ÖÔ∏è Voltar</button>
    <button id="salvar" onclick="salvarChecklist()" disabled>üíæ Salvar Checklist</button>
    <button id="pdfBtn" onclick="gerarPDF()">üìÑ Gerar PDF</button>

    <div class="rodape">
      Endere√ßo da empresa: Rua Exemplo, 123 - Cidade - CEP 00000-000
    </div>
  </div>

</div>

<script>
// PREENCHE DATA E HORA
document.getElementById('datetime').innerText = new Date().toLocaleString();

// MODELOS DE CHECKLIST
const modelos = {
  empilhadeira: [
    "Pneus e Rodas (calibragem)",
    "Garfos (patins) e mastro",
    "Vazamentos",
    "N√≠vel de √≥leo do motor",
    "N√≠vel de √≥leo hidr√°ulico",
    "Freios",
    "Buzina / sinaliza√ß√£o"
  ],
  carro: [
    "Luzes",
    "Vazamentos",
    "Espelhos e vidros"
  ],
  bau: ["Pneus","Luzes","Vazamentos","Freios"],
  f400: ["Pneus","Luzes","Vazamentos","Freios"]
};

// FUN√á√ïES PARA TROCAR DE TELA
function irParaChecklist(){
  const motorista = document.getElementById('motorista').value;
  const veiculo = document.getElementById('veiculo').value;
  const tipo = document.getElementById('tipo').value;

  if(!motorista || !veiculo || !tipo){
    alert("Preencha todos os campos antes de continuar!");
    return;
  }

  document.getElementById('resumoMotorista').innerText = motorista;
  document.getElementById('resumoVeiculo').innerText = veiculo;
  document.getElementById('resumoTipo').innerText = tipo;

  // Preenche a tabela de itens
  const tbody = document.querySelector('#tabela tbody');
  tbody.innerHTML = "";
  modelos[tipo].forEach(item=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `
      <td>${item}</td>
      <td class="bom" onclick="selecionar(this)">‚úî</td>
      <td class="anormal" onclick="selecionar(this)">‚ö†</td>
      <td class="na" onclick="selecionar(this)">N.A</td>
    `;
    tbody.appendChild(tr);
  });

  document.getElementById('tela-selecao').classList.remove('ativa');
  document.getElementById('tela-checklist').classList.add('ativa');
  verificarSalvar();
}

// SELE√á√ÉO DE CELULAS
function selecionar(td){
  td.parentNode.querySelectorAll('td').forEach(cell=>{
    cell.style.backgroundColor = ""; // reset
  });
  td.style.backgroundColor = td.classList.contains('bom') ? "#c8f7c5"
    : td.classList.contains('anormal') ? "#fff3b0"
    : "#c5d9f7";
  verificarSalvar();
}

// VERIFICA SE PODE ATIVAR O BOT√ÉO SALVAR
function verificarSalvar(){
  const tbody = document.querySelectorAll('#tabela tbody tr');
  let habilitar = tbody.length > 0;
  tbody.forEach(tr=>{
    if(!Array.from(tr.children).some(td=>td.style.backgroundColor)) habilitar = false;
  });
  document.getElementById('salvar').disabled = !habilitar;
}

// VOLTAR
function voltarSelecao(){
  document.getElementById('tela-checklist').classList.remove('ativa');
  document.getElementById('tela-selecao').classList.add('ativa');
}

// SALVAR (exemplo simples)
function salvarChecklist(){
  alert("Checklist salvo com sucesso!");
}

// GERAR PDF
function gerarPDF(){
  const element = document.getElementById('pdf-content'); // captura toda √°rea do PDF

  // Destacar itens ANORMAIS em vermelho para PDF
  document.querySelectorAll('#tabela tbody tr').forEach(tr=>{
    if(tr.querySelector('.anormal').style.backgroundColor === "rgb(255, 243, 176)"){ // amarelo
      tr.classList.add('anormal-pdf');
    } else {
      tr.classList.remove('anormal-pdf');
    }
  });

  // Substituir textarea de observa√ß√µes por div tempor√°ria
  const obs = document.getElementById('obs');
  const obsDiv = document.createElement('div');
  obsDiv.innerText = obs.value;
  obsDiv.style.border = "1px solid #ccc";
  obsDiv.style.padding = "8px";
  obsDiv.style.borderRadius = "4px";
  obsDiv.style.minHeight = "50px";
  obsDiv.id = "obs-pdf";
  obs.parentNode.replaceChild(obsDiv, obs);

  // Colocar data e hora no PDF
  const datetimeSpan = document.getElementById('datetime-pdf');
  datetimeSpan.innerText = new Date().toLocaleString();

  // Colocar valor do KM/Hor√≠metro no PDF
  const kmInput = document.getElementById('kmHorimetro');
  const kmSpan = document.createElement('span');
  kmSpan.innerText = kmInput.value;
  kmInput.parentNode.replaceChild(kmSpan, kmInput);

  const opt = {
    margin: 10,
    filename: `Checklist_${new Date().toISOString().slice(0,10)}.pdf`,
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  };

  html2pdf().set(opt).from(element).save().then(()=>{
    kmSpan.parentNode.replaceChild(kmInput, kmSpan);
    obsDiv.parentNode.replaceChild(obs, obsDiv);
  });
}

// SERVICE WORKER
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
  .then(()=>console.log('Service Worker registrado'))
  .catch(err=>console.log('Erro SW',err));
}
</script>
</body>
</html>

