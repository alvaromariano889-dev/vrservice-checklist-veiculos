<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Checklist Di√°rio de Ve√≠culos</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="manifest.json">

<script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

<style>
body {
  font-family: Arial, sans-serif;
  background: #f4f4f4;
  padding: 10px;
  margin: 0;
}
.container {
  max-width: 900px;
  margin: auto;
  background: #fff;
  padding: 20px;
  border-radius: 6px;
}
.logo, h2, .datetime {
  text-align: center;
}
label {
  font-weight: bold;
  display: block;
  margin-top: 8px;
}
input, select, textarea {
  width: 100%;
  padding: 8px;
  box-sizing: border-box;
  border: 1px solid #ccc;
  border-radius: 4px;
}
button {
  margin-top: 15px;
  padding: 12px 24px;
  font-size: 16px;
  cursor: pointer;
  border: none;
  border-radius: 6px;
  background: #0a7cff;
  color: white;
}
button:hover:not(:disabled) { background: #0962d8; }
button:disabled { background: #ccc; cursor: not-allowed; }

/* telas */
.tela { display: none; }
.tela.ativa { display: block; }

/* grid responsivo */
.grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-top: 20px;
}

/* resumo */
.resumo {
  background: #f8f9fa;
  padding: 15px;
  border-radius: 6px;
  margin: 15px 0;
}
.resumo p { margin: 5px 0; font-size: 16px; }

/* tabela */
.table {
  width: 100%;
  border-collapse: collapse;
  margin: 20px 0;
}
.table th, .table td {
  border: 1px solid #333;
  padding: 10px 8px;
  text-align: center;
  font-size: 14px;
}
.table th {
  background: #e9ecef;
  font-weight: bold;
}
.table th:first-child, .table td:first-child {
  text-align: left;
  width: 40%;
}

/* cores das linhas */
.bom { background: #c8f7c5 !important; }
.anormal { background: #fff3b0 !important; }
.na { background: #c5d9f7 !important; }

.obs-box { margin: 20px 0; }
#kmHorimetro { width: 200px !important; display: inline-block; }

/* rodap√© para PDF */
.rodape {
  text-align: center;
  font-size: 12px;
  margin-top: 20px;
}

/* PDF otimizado */
@media print {
  body { background: white; }
  .container { max-width: none; padding: 10mm; }
  .tela:not(.ativa), button { display: none !important; }
}
</style>
</head>
<body>

<div class="container">
  <div class="logo"><strong>LOGO DA EMPRESA</strong></div>
  <h2>Checklist Di√°rio de Inspe√ß√£o</h2>
  <div class="datetime" id="datetime"></div>
</div>

<!-- TELA 1: SELE√á√ÉO -->
<div class="container tela ativa" id="tela-selecao">
  <h3>üìã Dados iniciais</h3>
  <div class="grid">
    <div>
      <label>Motorista / Operador</label>
      <input list="motoristas" id="motorista" placeholder="Digite ou selecione">
      <datalist id="motoristas">
        <option value="Jo√£o Silva">
        <option value="Maria Souza">
        <option value="Carlos Lima">
      </datalist>
    </div>
    <div>
      <label>Ve√≠culo / Placa ou Patrim√¥nio</label>
      <input list="veiculos" id="veiculo" placeholder="Digite ou selecione">
      <datalist id="veiculos">
        <option value="ABC-1234">
        <option value="DEF-5678">
        <option value="GHI-9012">
      </datalist>
    </div>
    <div>
      <label>Tipo de Ve√≠culo</label>
      <select id="tipo">
        <option value="">Selecione</option>
        <option value="empilhadeira">Empilhadeira</option>
        <option value="carro">Carro</option>
        <option value="bau">Caminh√£o Ba√∫</option>
        <option value="f400">Caminh√£o Aberto (F400)</option>
      </select>
    </div>
  </div>
  <button onclick="irParaChecklist()">‚û°Ô∏è Continuar para checklist</button>
</div>

<!-- TELA 2: CHECKLIST -->
<div class="container tela" id="tela-checklist">
  <div class="resumo">
    <p><strong>Motorista:</strong> <span id="resumoMotorista"></span></p>
    <p><strong>Ve√≠culo:</strong> <span id="resumoVeiculo"></span></p>
    <p><strong>Tipo:</strong> <span id="resumoTipo"></span></p>
    <p><strong>KM ou Hor√≠metro:</strong> <input type="number" id="kmHorimetro" min="0"></p>
  </div>

  <table class="table" id="tabela">
    <thead>
      <tr>
        <th>ITEM</th>
        <th>BOM</th>
        <th>ANORMAL</th>
        <th>N.A.</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <div class="obs-box">
    <label>Observa√ß√µes (obrigat√≥rio se houver item ANORMAL)</label>
    <textarea id="obs" rows="3" placeholder="Descreva qualquer irregularidade encontrada..."></textarea>
  </div>

  <button onclick="voltarSelecao()">‚¨ÖÔ∏è Voltar</button>
  <button id="salvar" onclick="salvarChecklist()" disabled>üíæ Salvar Checklist</button>
  <button id="pdfBtn" onclick="gerarPDF()">üìÑ Gerar PDF</button>

  <div class="rodape">
    Endere√ßo da empresa: Rua Exemplo, 123 - Cidade - CEP 00000-000
  </div>
</div>

<script>
// mostrar data e hora
document.getElementById('datetime').innerText = new Date().toLocaleString();

// checklist por tipo
const modelos = {
  empilhadeira: ["Pneus e Rodas", "Garfos e mastro", "Vazamentos","√ìleo motor","√ìleo hidr√°ulico","Freios","Buzina"],
  carro: ["Luzes","Vazamentos","Espelhos e vidros","Freios","√ìleo motor","Pneus e rodas"],
  bau: ["Luzes","Vazamentos","Freios","Pneus e rodas","Portas e travas"],
  f400: ["Luzes","Vazamentos","Freios","Pneus e rodas","Ca√ßamba / carroceria"]
};

// mostrar checklist
function irParaChecklist() {
  const motorista = document.getElementById('motorista').value;
  const veiculo = document.getElementById('veiculo').value;
  const tipo = document.getElementById('tipo').value;
  if(!motorista||!veiculo||!tipo){ alert('Preencha todos os campos!'); return; }
  document.getElementById('resumoMotorista').innerText = motorista;
  document.getElementById('resumoVeiculo').innerText = veiculo;
  document.getElementById('resumoTipo').innerText = tipo;
  const tbody = document.querySelector('#tabela tbody'); tbody.innerHTML='';
  modelos[tipo].forEach(item=>{
    const tr=document.createElement('tr');
    tr.innerHTML=`<td>${item}</td>
      <td><input type="radio" name="${item}" value="bom"></td>
      <td><input type="radio" name="${item}" value="anormal"></td>
      <td><input type="radio" name="${item}" value="na"></td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('tela-selecao').classList.remove('ativa');
  document.getElementById('tela-checklist').classList.add('ativa');
}

// voltar tela
function voltarSelecao(){
  document.getElementById('tela-checklist').classList.remove('ativa');
  document.getElementById('tela-selecao').classList.add('ativa');
}

// verificar sele√ß√£o completa
function verificarChecklist(){
  const radios = document.querySelectorAll('#tabela tbody input[type="radio"]');
  const itens = {};
  radios.forEach(r=>{if(!itens[r.name]) itens[r.name]=false; if(r.checked) itens[r.name]=true;});
  const todosSelecionados = Object.values(itens).every(v=>v===true);
  document.getElementById('salvar').disabled = !todosSelecionados;
}

// colorir linhas
document.querySelector('#tabela').addEventListener('change', e=>{
  const tr = e.target.closest('tr');
  tr.classList.remove('bom','anormal','na');
  if(e.target.checked){
    if(e.target.value==='bom') tr.classList.add('bom');
    if(e.target.value==='anormal') tr.classList.add('anormal');
    if(e.target.value==='na') tr.classList.add('na');
  }
  verificarChecklist();
});

// salvar checklist JSON
function salvarChecklist(){
  const checklist = {
    motorista: document.getElementById('motorista').value,
    veiculo: document.getElementById('veiculo').value,
    tipo: document.getElementById('tipo').value,
    km: document.getElementById('kmHorimetro').value,
    observacoes: document.getElementById('obs').value,
    itens: {}
  };
  document.querySelectorAll('#tabela tbody tr').forEach(tr=>{
    const item = tr.cells[0].innerText;
    const value = tr.querySelector('input[type="radio"]:checked')?.value || '';
    checklist.itens[item]=value;
  });
  // salvar localStorage
  localStorage.setItem(`checklist_${new Date().toISOString()}`, JSON.stringify(checklist));
  alert('Checklist salvo com sucesso!');
}

// gerar PDF
function gerarPDF(){
  const element = document.getElementById('tela-checklist'); // CORRIGIDO

  // Destacar itens ANORMAIS em vermelho para PDF
  document.querySelectorAll('#tabela tbody tr').forEach(tr=>{
    if(tr.classList.contains('anormal')){
      tr.classList.add('anormal-pdf');
    } else {
      tr.classList.remove('anormal-pdf');
    }
  });

  const opt = {
    margin: 10,
    filename: `Checklist_${new Date().toISOString().slice(0,10)}.pdf`,
    image:{type:'jpeg',quality:0.98},
    html2canvas:{scale:2},
    jsPDF:{unit:'mm',format:'a4',orientation:'portrait'}
  };

  html2pdf().set(opt).from(element).save();
}

// registrar service worker
if('serviceWorker' in navigator){
  navigator.serviceWorker.register('sw.js')
  .then(()=>console.log('Service Worker registrado'))
  .catch(err=>console.log('Erro SW',err));
}

</script>
</body>
</html>

